# STL - VMD - Parallel [TimesNet-BiLSTM]

----------------------------------------------------------------

## Overview  
This project implements a deep learning model to forecast the **active power** generated by photovoltaic (PV) solar panels, with the aim of achieving minimal errors and a high R².

## Model Architecture  
Building upon the model described in [2], I applied data-processing steps from that work and then enhanced the architecture by integrating Variational Mode Decomposition (VMD) into the flow of the existing Seasonal‑Trend decomposition using LOESS (STL) → Parallel [TimesNet + BiLSTM] model.  

![Scheme of the DL model architecture](/docs/architecture.png)

### Components explained  
1. **VMD** (Variational Mode Decomposition) – Extracts intrinsic signal modes.  
2. **STL** (Seasonal-Trend decomposition using LOESS) – Separates trend, seasonality, and residuals.  
3. **TimesNet** – Convolutional temporal network to capture multi-scale patterns.  
4. **BiLSTM** (Bidirectional Long Short-Term Memory) – Processes sequential data in both time directions for prediction.


## Dataset  
- Source: Desert Knowledge Australia Solar Centre (DKASC)  
- Site: Yulara Solar System [1]

### Raw data summary  
| Attribute       | Value                     |
|-----------------|---------------------------|
| Sampling rate   | 5 minutes                 |
| Size            | 949 949 rows ×15 columns  |
| Period          | 02/04/2017 08:00:00 – 25/05/2025 08:15:00 |

### Features list  
| Feature                      | Description                                | Units   |
|------------------------------|--------------------------------------------|---------|
| Timestamp                    | Index for processed data                    | datetime|
| Current_Phase_Average_Mean   | Current phase average                        | A       |
| Active_Energy_Delivered_Received | Energy exchanged in system               | kWh     |
| Active_Power                 | Generated power from PV solar panels        | kW      |
| Wind_Speed                   | Wind speed                                   | m/s     |
| Weather_Temperature_Celsius  | Air temperature                              | °C      |
| Global_Horizontal_Radiation  | Horizontal irradiation to PV panels         | W/m²   |
| Wind_Direction               | Wind direction in degrees                    | °       |
| Weather_Daily_Rainfall       | Daily accumulated rainfall                   | mm      |
| Max_Wind_Speed               | Maximum wind speed                          | m/s     |
| Air_Pressure                 | Air pressure                                | hPa     |
| Hail_Accumulation            | Hail accumulated                            | mm      |
| Pyranometer_1                | Horizontal radiation measured by pyranometer| W/m²   |
| Temperature_Probe_1          | First panel temperature sensor              | °C      |
| Temperature_Probe_2          | Second panel temperature sensor             | °C      |

### Pre-processing details  
- To comply with the public-repo requirement of [2], I replicated the original work and then extended it.  
- Given that the dataset was downloaded in 2024, several features were rejected: *Current_Phase_Average_Mean*, *Weather_Daily_Rainfall*, *Hail_Accumulation*, *Wind_Direction*, and *Air_Pressure*.  
- The feature *Active_Energy_Delivered_Received* was modified to only include the “Received” portion (renamed *Active_Energy_Received*).  
- Data processing notebook: `/notebooks/Modify_data_Yulara.ipynb`  
- Processed dataset: `/data/processed/dataset_Laundry_modified.csv`  
- Data split: 60 % training, 20 % validation, 20 % test

### Benchmark & Replica  
| Model                                   | Source         | MAE     | RMSE    | R²     |
|----------------------------------------|----------------|---------|---------|--------|
| STL – PA [TimesNet-BiLSTM]             | Paper [2]      | 5.1732  | 9.6461  | 0.9885 |
| STL – VMD – PA [TimesNet-BiLSTM] (mine) | This work      | 4.8068  | 8.5313  | 0.9898 |

## Environment & Testing  
**Hardware configuration**  
- GPU: NVIDIA GeForce RTX 3050  
- CUDA version: 13.0  
- OS: Ubuntu 22.04  
- RAM: 15 GB

**Main frameworks**  
- PyTorch – deep learning  
- Pandas – data management  
- NumPy – linear algebra  
- Matplotlib – visualization  
- Scikit-learn – preprocessing & metrics  
- Statsmodels – STL decomposition  
- tqdm – progress tracking

**Model settings**  
- Optimizer: Adam  
- Loss: MSE  
- No early stopping  
- Lookback (sequence_length): 48  
- Prediction horizon (prediction_length): 1 (i.e., 15 minutes)

### Parameter configuration  
| Parameter         | Description                             | Value      |
|-------------------|-----------------------------------------|------------|
| Period            | Possible periodicity length             | 9          |
| alpha             | Bandwidth of modal functions            | 0.1        |
| k                 | Number of modes (VMD)                   | 3          |
| λ (lambda)        | Lagrange multiplier                     | 85         |
| num_kernels       | Number of kernels in TimesNet CNN block | 7          |
| num_times_blocks  | Number of TimesNet blocks                | 2          |
| top_k             | Number of significant periods            | 2          |
| dropout           | Fraction of neurons dropped             | 0.1188     |
| hidden_size       | Neurons per BiLSTM layer                | 32         |
| layers            | Number of BiLSTM layers                  | 3          |
| bidirectional     | Enable bidirectional flow                | true       |
| epochs            | Training iterations                      | 30         |
| batch_size        | Samples per batch                        | 64         |
| learning_rate     | Learning rate                            | 0.001      |

Parameters can be modified in `/configs/parameters.yaml` for new experiments.

### Outputs

The proposed model improved the metrics over [2], considering MAE, RMSE and R²:


| Model                                   | MAE     | RMSE    | R²     |
|----------------------------------------|---------|---------|--------|
| STL – PA [TimesNet-BiLSTM]             | 5.1732  | 9.6461  | 0.9885 |
| STL – VMD – PA [TimesNet-BiLSTM]       | 4.8068  | 8.5313  | 0.9898 |

![History plot comparing predicting values with true values for a random period of time](/docs/History_plot.png)
![Scatter plot evaluating the correlation between predicting values and true values](/docs/Scatter_plot.png)

## Run

1. Check the requirements.txt

```shell
pip install -r requirements.txt
```

2. To train a new model

```shell
python src/app/train.py
```

The trained model will be saved in /outputs/models/VMD_TimesNet_BiLSTM/.

3. To test the model

```shell
python src/app/test.py
```

## References

[1] Desert Knowledge Australia Solar Centre, “327.6kw, poly-si, fixed, 2016, laundry,” https://dkasolarcentre.com.au/source/yulara/yulara-4-fixed-laundry, 2025.

[2] J. Gong and et.al, “Parallel timesnet-bilstm model for ultra-short-term photovoltaic power forecasting using stl decomposition and auto-tuning,” Energy, vol. 320, p. 135286, 2025.